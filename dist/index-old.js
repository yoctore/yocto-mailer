"use strict";function Mailer(e){this.logger=e,this.mailers=[{instance:require("./modules/nodemailer")(e),name:"nodemailer"},{instance:require("./modules/mandrill")(e),name:"mandrill"}],this.mailer={}}var logger=require("yocto-logger"),_=require("lodash"),Promise=require("promise");Mailer.prototype.get=function(e){return this[e]},Mailer.prototype.enableCompleteClean=function(){return this.isInstanciate()?this.mailer.instance.processCompleteClean(!0):(this.logger.error(["[ Mailer.enableCompleteClean ] - Cannot enable complete clean function.","Mailer instance is not defined.",'Please choose you mailer instance by "use" method'].join(" ")),!1)},Mailer.prototype.disableCompleteClean=function(){return this.isInstanciate()?this.mailer.instance.processCompleteClean(!1):(this.logger.error(["[ Mailer.disableCompleteClean ] - Cannot disable complete clean function.","Mailer instance is not defined.",'Please choose you mailer instance by "use" method'].join(" ")),!1)},Mailer.prototype.use=function(e){var i=_.where(this.mailers,{name:e});return _.isEmpty(i)?(this.logger.error(["[ Mailer.use ] - Invalid instance name given.",'Please use "nodemailer" or "mandrill"'].join(" ")),!1):(this.mailer=_.first(i),this.logger.info(["[ Mailer.use ] - selected instance",e,"founded. Use it !"].join(" ")),!0)},Mailer.prototype.addRecipient=function(e,i,n){return this.isInstanciate()?this.mailer.instance.addRecipient(e,i,n):(this.logger.error(["[ Mailer.addRecipient ] - Cannot add recipiend.","Mailer instance is not defined.",'Please choose you mailer instance by "use" method'].join(" ")),!1)},Mailer.prototype.addCC=function(e,i){return this.addRecipient(e,i,"cc")},Mailer.prototype.addBCC=function(e,i){return this.addRecipient(e,i,"bcc")},Mailer.prototype.setExpeditor=function(e,i){return this.isInstanciate()?this.mailer.instance.setExpeditor(e,i):(this.logger.error(["[ Mailer.setExpeditor ] - Cannot set expeditor.","Mailer instance is not defined.",'Please choose you mailer instance by "use" method'].join(" ")),!1)},Mailer.prototype.setConfig=function(e){return new Promise(function(i,n){if(this.isInstanciate())this.mailer.instance.setConfig(e).then(function(e){i(e)},function(e){n(e)});else{var t=["[ Mailer.setConfig ] - mailer is not define,","Please define your mailer whith use method."].join(" ");this.logger.error(t),n(t)}}.bind(this))},Mailer.prototype.send=function(e,i,n){return new Promise(function(t,r){if(!this.isInstanciate()){var o=["[ Mailer.send ] - mailer is not instanciate.","please configure your mailer before use send method."].join(" ");return this.logger.error(o),r(o)}var a=[e,i];_.isString(n)&&a.push(n),this.mailer.instance.send.apply(this.mailer.instance,a).then(function(e){t(e)},function(e){r(e)})}.bind(this))},Mailer.prototype.addReplyTo=function(e){return this.isInstanciate()?this.mailer.instance.addReplyTo(e):(this.logger.error(["[ Mailer.addReplyTo ] - Cannot set expeditor.","Mailer instance is not defined.",'Please choose you mailer instance by "use" method'].join(" ")),!1)},Mailer.prototype.isInstanciate=function(){return!_.isEmpty(this.mailer)&&!_.isUndefined(this.mailer.instance)},module.exports=function(e){return(_.isUndefined(e)||_.isNull(e))&&(logger.warning("[ Mailer.constructor ] - Invalid logger given. Use internal logger"),e=logger),new Mailer(e)};