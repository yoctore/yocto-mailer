"use strict";function Mailer(){this.transport={},this.mailOptions={from:"",to:"",subject:"",html:"",cc:"",bcc:""}}var nodemailer=require("nodemailer"),smtpTransport=require("nodemailer-smtp-transport"),logger=require("yocto-logger"),_=require("lodash"),Joi=require("joi");Mailer.prototype.addRecipient=function(a){return this.processEmailFormat(a,"to","addRecipient")},Mailer.prototype.setConfigSMTP=function(a){var b=Joi.object().keys({host:Joi.string().required(),secureConnection:Joi["boolean"]().required(),port:Joi.number().required(),auth:Joi.object().keys({user:Joi.string().email().required(),pass:Joi.string().required()}).allow("user","pass")}).allow("host","secureConnection","port","auth"),c=Joi.validate(a,b);return _.isEmpty(c)||_.isEmpty(c.error)?(logger.info("[ Mailer.setConfigSMTP ] - Set smtp configuration ok "),this.transport=nodemailer.createTransport(smtpTransport(a)),!0):(logger.error("[ Mailer.setConfigSMTP ] - setting smtp, error description :"),_.forEach(c.error.details,function(a){logger.warning("[ Mailer.setConfigSMTP ] - "+a.message+" at "+a.path)}),!1)},Mailer.prototype.setExpeditor=function(a){return this.processEmailFormat(a,"from","setExpeditor")},Mailer.prototype.addCC=function(a){return this.processEmailFormat(a,"cc","addCC")},Mailer.prototype.addBCC=function(a){return this.processEmailFormat(a,"bcc","addBCC")},Mailer.prototype.processEmailFormat=function(a,b,c){var d=Joi.string().email();return _.isArray(a)&&(d=Joi.array().items(Joi.string().email())),d=d.validate(a),_.isEmpty(d)||_.isEmpty(d.error)?(logger.info("[ Mailer."+c+" ] - Validation email ok "),this.mailOptions[b]=a,!0):(logger.error("[ Mailer."+c+" ] - Validation email failed, at least one string dosen't pass email validation"),!1)},Mailer.prototype.send=function(a,b,c){logger.info("send mail "),_.isString(b)&&(this.mailOptions.html=b),_.isString(a)&&(this.mailOptions.subject=a),console.log("---- display"),console.log(this.mailOptions)},Mailer.prototype.deleteMailOptions=function(){logger.info("delete some mail options : to, cc, bcc, subject, html "),this.mailOptions.to="",this.mailOptions.cc="",this.mailOptions.bcc="",this.mailOptions.subject="",this.mailOptions.html=""},module.exports=new Mailer;