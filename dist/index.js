"use strict";function Mailer(a){this.logger=a,this.mailers=[{instance:require("./modules/nodemailer")(a),name:"nodemailer"},{instance:require("./modules/mandrill")(a),name:"mandrill"}],this.mailer={}}var logger=require("yocto-logger"),_=require("lodash"),Promise=require("promise");Mailer.prototype.get=function(a){return this[a]},Mailer.prototype.enableCompleteClean=function(){return this.isInstanciate()?this.mailer.instance.processCompleteClean(!0):(this.logger.error(["[ Mailer.enableCompleteClean ] - Cannot enable complete clean function.","Mailer instance is not defined.",'Please choose you mailer instance by "use" method'].join(" ")),!1)},Mailer.prototype.disableCompleteClean=function(){return this.isInstanciate()?this.mailer.instance.processCompleteClean(!1):(this.logger.error(["[ Mailer.disableCompleteClean ] - Cannot disable complete clean function.","Mailer instance is not defined.",'Please choose you mailer instance by "use" method'].join(" ")),!1)},Mailer.prototype.use=function(a){var b=_.where(this.mailers,{name:a});return _.isEmpty(b)?(this.logger.error(["[ Mailer.use ] - Invalid instance name given.",'Please use "nodemailer" or "mandrill"'].join(" ")),!1):(this.mailer=_.first(b),this.logger.info(["[ Mailer.use ] - selected instance",a,"founded. Use it !"].join(" ")),!0)},Mailer.prototype.addRecipient=function(a,b,c){return this.isInstanciate()?this.mailer.instance.addRecipient(a,b,c):(this.logger.error(["[ Mailer.addRecipient ] - Cannot add recipiend.","Mailer instance is not defined.",'Please choose you mailer instance by "use" method'].join(" ")),!1)},Mailer.prototype.addCC=function(a,b){return this.addRecipient(a,b,"cc")},Mailer.prototype.addBCC=function(a,b){return this.addRecipient(a,b,"bcc")},Mailer.prototype.setExpeditor=function(a,b){return this.isInstanciate()?this.mailer.instance.setExpeditor(a,b):(this.logger.error(["[ Mailer.setExpeditor ] - Cannot set expeditor.","Mailer instance is not defined.",'Please choose you mailer instance by "use" method'].join(" ")),!1)},Mailer.prototype.setConfig=function(a){return new Promise(function(b,c){if(this.isInstanciate())this.mailer.instance.setConfig(a).then(function(a){b(a)},function(a){c(a)});else{var d=["[ Mailer.setConfig ] - mailer is not define,","Please define your mailer whith use method."].join(" ");this.logger.error(d),c(d)}}.bind(this))},Mailer.prototype.send=function(a,b,c){return new Promise(function(d,e){if(!this.isInstanciate()){var f=["[ Mailer.send ] - mailer is not instanciate.","please configure your mailer before use send method."].join(" ");this.logger.error(f),e(f)}var g=[a,b];_.isString(c)&&g.push(c),this.mailer.instance.send.apply(this.mailer.instance,g).then(function(a){d(a)},function(a){e(a)})}.bind(this))},Mailer.prototype.addReplyTo=function(a){return this.isInstanciate()?this.mailer.instance.addReplyTo(a):(this.logger.error(["[ Mailer.addReplyTo ] - Cannot set expeditor.","Mailer instance is not defined.",'Please choose you mailer instance by "use" method'].join(" ")),!1)},Mailer.prototype.isInstanciate=function(){return!_.isEmpty(this.mailer)&&!_.isUndefined(this.mailer.instance)},module.exports=function(a){return(_.isUndefined(a)||_.isNull(a))&&(logger.warning("[ Mailer.constructor ] - Invalid logger given. Use internal logger"),a=logger),new Mailer(a)};