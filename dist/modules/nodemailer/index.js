"use strict";function NodeMailer(){this.transport={},this.mailOptions={from:"",to:[],subject:"",html:"",cc:[],bcc:[]},this.defaultMailOption=_.omit(_.clone(this.mailOptions),"from"),this.logger=logger}var nodemailer=require("nodemailer"),smtpTransport=require("nodemailer-smtp-transport"),logger=require("yocto-logger"),_=require("lodash"),joi=require("joi");NodeMailer.prototype.setConfig=function(a){var b=joi.object().keys({host:joi.string().required(),secureConnection:joi["boolean"]().required(),port:joi.number().required(),auth:joi.object().keys({user:joi.string().email().required(),pass:joi.string().required()}).allow("user","pass")}).allow("host","secureConnection","port","auth"),c=joi.validate(a,b);return _.isEmpty(c)||_.isEmpty(c.error)?(this.logger.info("[ NodeMailer.setConfigSMTP ] - Set smtp configuration ok"),this.transport=nodemailer.createTransport(smtpTransport(a)),!0):(this.logger.error("[ NodeMailer.setConfigSMTP ] - setting smtp, error description :"),_.forEach(c.error.details,function(a){this.logger.warning("[ NodeMailer.setConfigSMTP ] - "+a.message+" at "+a.path)}),!1)},NodeMailer.prototype.send=function(a,b,c,d){function e(a){a.logger.debug("[ NodeMailer.deleteMailOptions ] - Delete mail otpions"),_.extend(a.mailOptions,a.defaultMailOption)}this.logger.info("[ NodeMailer.send ] - Try sending a new email"),this.mailOptions.html=_.isString(b)?b:"",this.mailOptions.subject=_.isString(a)?a:"",c=!_.isUndefined(c)&&_.isFunction(c)?c:function(a){this.logger.info("[ MandrillWrapper.send.defaultCallBackSendMail ] -  sending message, info details id : "+a)},d=!_.isUndefined(d)&&_.isFunction(d)?d:function(a){this.logger.info("[ MandrillWrapper.send.defaultCallBackSendMail ] -  sending message, error details id : "+a)};var f=this;_.isEmpty(this.transport)||_.isEmpty(this.mailOptions.to)||_.isEmpty(this.mailOptions.from)||_.isEmpty(this.mailOptions.subject)||_.isEmpty(this.mailOptions.html)?(this.logger.error("[ NodeMailer.send ] - can't send mail, please check configuration."),e(this)):this.transport.sendMail(this.mailOptions,function(a,b){_.isEmpty(a)?c(b):d(a),e(f)})},module.exports=new NodeMailer;