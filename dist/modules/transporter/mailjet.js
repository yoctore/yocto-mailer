"use strict";function MailjetTransporter(e){this.logger=e,this.state=!1,this.mailjet={},this.version="3.1"}var logger=require("yocto-logger"),_=require("lodash"),mailjet=require("node-mailjet"),Q=require("q"),joi=require("joi");MailjetTransporter.prototype.isReady=function(){var e=Q.defer();return _.isEmpty(this.mailjet)?e.reject():e.resolve(),e.promise},MailjetTransporter.prototype.send=function(e,r,t,i,o){var n=Q.defer(),s=mailjet[t||"post"](r||"send",{version:["v",i||this.version].join("")});return(_.has(e,"ID")||_.has(e,"Address"))&&(s=s.id(_.get(e,"ID")||_.get(e,"Address")),_.omit(e,"ID")),console.log(o),_.isString(o)&&(s=s.action(o)),s.request(e).then(function(e){return n.resolve(e)}).catch(function(e){return n.reject(e)}),n.promise},MailjetTransporter.prototype.create=function(e){mailjet=mailjet.connect(e.publicKey||process.env.MJ_APIKEY_PUBLIC,e.privateKey||process.env.MJ_APIKEY_PRIVATE);var r=joi.object().required().keys({apiKey:joi.string().required().empty(),apiSecret:joi.string().required().empty()}).unknown(),t=joi.validate(mailjet,r);return _.isNull(t.error)?(this.mailjet=t.value,this):(this.logger.error(["[ MailjetTransporter.createTransport ] - Cannot create transport for mailjet.","Error is :",t.error].join(" ")),!1)},module.exports=function(e){return(_.isUndefined(e)||_.isNull(e))&&(logger.warning("[ MailjetTransporter.constructor ] - Invalid logger given. Use internal logger"),e=logger),new MailjetTransporter(e)};