"use strict";function Converter(e,t){this.logger=t,this.message=e,this.customiser=require("./customiser")(this.logger),this.sender=require("./sender")(this.logger),this.rules=require("./config/converter.json")}var logger=require("yocto-logger"),_=require("lodash");Converter.prototype.update=function(e){return this.message=e,this},Converter.prototype.toString=function(){return JSON.stringify(this.message)},Converter.prototype.toNodeMailer=function(){return this.convert(this.sender.NODEMAILER_TYPE)},Converter.prototype.toMandrill=function(){return this.convert(this.sender.MANDRILL_TYPE)},Converter.prototype.convert=function(e){var t=e===this.sender.NODEMAILER_TYPE?this.message:{},r=_.get(this.rules,e);return e!==this.sender.NODEMAILER_TYPE&&_.isArray(r)&&!_.isEmpty(r)?_.map(r,function(e){var r=_.isFunction(this.customiser[e.customiser])?this.customiser[e.customiser](e.sourcePath,_.get(this.message,e.sourcePath)):_.get(this.message,e.sourcePath);if(_.has(t,e.destinationPath)){var s=_.get(t,e.destinationPath);_.isArray(s)||_.isObject(s)?(_.isArray(s)&&(s.push(r),s=_.flatten(s)),_.isObject(s)&&!_.isArray(s)&&_.merge(s,r)):s=r,r=s}_.isUndefined(r)||_.set(t,e.destinationPath,r)}.bind(this)):this.logger.warning(["[ Converter.convert ] - cannot process convertion toÂ [",e,"] format. Rules are not defined or is empty"].join(" ")),!_.isEmpty(t)&&this.sender.store(t,e)},module.exports=function(e,t){return(_.isUndefined(t)||_.isNull(t))&&(logger.warning("[ Converter.constructor ] - Invalid logger given. Use internal logger"),t=logger),new Converter(e,t)};